---
layout: post
title: USERS
permalink: cmd/cli/resources/users
redirect_from:
 - cmd/cli/resources/users.md/
---

# User Account and Access management

[AuthN](/cmd/authn/README.md) is AIS authorization server that can be deployed to manage user access to one or more AIS clusters.

All commands (except `logout`) send requests to AuthN URL defined in AIS CLI configuration file. Configuration can be overridden with environment variable `AUTHN_URL`, e.g., `AUTHN_URL=http://10.0.0.20:52001 ais auth add ...`.

The CLI provides an easy way to manage users and to grant and revoke access permissions.
Only users with `Admin` role can manage AuthN server.

Every request to AuthN, except `login` and `logout`, requires a token.
The token is generated by the server after the user successfully logs in.
CLI automatically saves the received token to user's configuration directory and attaches it to every request.

When a user with valid issued tokens is removed or a token is revoked, AuthN notifies registered clusters, so they update their blacklists.

## Getting a token


### Generate a token for CLI

After successful login, CLI saves the generated token to user's configuration directory for the future use and automatically passed it with every request to AuthN.
For convenience, CLI prints out the generated token so it can be copied and used with other clients.

```console
$ ais auth login -p admin admin
Token(/home/ubuntu/.config/ais/auth.token):
eyJhbGciOiJIUuI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1ZSwiZThwaXJlcyI6IjIwMjAtMDYtMTFUMTY6MzU6MDAuODQyNzMzNjU1LTA3OjAwIiwidXNlcm5hbWUiOiJhZG1pbiJ9.ppyMR8EE37M9O9Kl9ybyB7CE0fq6hIwL3Sa-5OUea8I
```

### Generate a token to a file

CLI supports loading a token from a custom location.
One possible usage is imitating Linux `sudo` command.
First, a user logs in as an Admin and saves the token to some location.
Second, the user logs in as a regular user with default options.
It results in that the regular requests use the last generated token for all requests.
But when the user needs to modify any AuthN data, the user executes CLI with optional path to the admin token.

```console
# generate a token and save to a given location
$ ais auth login -p admin --file ./admin.token admin
Token saved to ./admin.token

# log in as a regular user
$ ais auth login -p pass user
Token(/home/ubuntu/.config/ais/auth.token):
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1Z...

# create bucket as a regular user
$ ais create bucket ais://bck1

# removing a user requres admin's token, pass path to the token to CLI
$ AUTHN_TOKEN_FILE=./admin.token ais auth rm user tmpUser1
```

## Command List

## Register new user

`ais auth add user [-p USER_PASS] USER_NAME [ROLE [ROLE...]]`

Register the user and assign the list of roles to the user.

If the role is omitted, the new user does not have any permissions. It may be useful for
case: a user needs an access to one or few buckets. Instead of creating a new role just
for the user, register a user with empty role and grant permissions to the required buckets.

**Examples:**

```console
$ ais auth add user -p password user1
$ ais auth add user -p password user2 PowerUser
$ ais auth show user
NAME    ROLES
admin   Admin
user1   -
user2   PowerUser
```

## Update user

`ais auth update user [-p USER_PASS] USER_NAME [ROLE [ROLE...]]`

Updates user password and list of roles. If role list is omitted, the current
user role remains unchanged.
Changing role for built-in account `admin` is forbidden.

## Unregister existing user

`ais auth rm user USER_NAME`

Remove an existing user and revokes all tokens issued for the user.
The built-in account `admin` cannot be removed.

## List registered users

`ais auth show user`

Displays the list of registered users.

```console
$ ais auth show user
NAME    ROLES
admin   Admin
user1   Guest-clu1,Guest-clu2
user2   PowerUser-clu1
```

## List existing roles

`ais auth show role`

Displays existing roles in alphabetical order.

```console
$ ais auth show role
ROLE            DESCRIPTION
Admin           AuthN administrator
BucketOwner     Full access to buckets
Guest           Read-only access to buckets
PowerUser       Full access to cluster
```

## Log in to AIS cluster

`ais auth login [-p USER_PASS] USER_NAME`

Issue a token for a user.
After successful login, user's token is saved to CLI configuration directory (usually it is `~/.config/ais/`) with a filename `auth.token`.
Next CLI runs automatically load and use the token for every request to AIS cluster.
The saved token can be used by other applications, like `curl`.
Please see [AuthN documentation](/cmd/authn/README.md) to read how to use AuthN API directly.

## Log out

`ais auth logout`

Erase user's token from a local machine. The token is not revoked, so it can be used by any application until it expires.
To forbid using the token from any application, the token must be revoked manually in addition to logging out.

## Register new cluster

`ais auth add cluster CLUSTER_ID [ALIAS] URL [URL..]`

Register the cluster by its ID and assign the list of URLs for sending notifications.
A user may assign an alias to the cluster for convenience: AuthN commands accepts both ID and Alias in requests.
Alias must be a unique name.  Alias is an arbitrary name, but it should not start with `http`.
In this case CLI treats the alias as the first URL.

On successful cluster registration, AuthN automatically creates a few predefined unique roles for the cluster: with full access,
read-write access to all its buckets, and read-only access to the cluster.
Please note that the role names include cluster's alias if it was defined. If alias is omitted, AuthN adds cluster ID to role name.

See full example in [List registered clusters](#list-registered-clusters).

## Update existing cluster

`ais auth update cluster CLUSTER_ID [ALIAS] URL [URL..]`

Replaces the list of URLs or changes alias for an existing cluster.

## Unregister existing cluster

`ais auth rm cluster CLUSTER_ID`

Remove the existing cluster from notification list.

## List registered clusters

`ais auth show cluster`

Display the list of the cluster that subscribe to AuthN notifications.

```console
# register a cluster without an alias
$ ais auth add cluster 2xs35th89 http://172.0.10.10 http://10.0.10.10

# register a cluster with an alias
$ ais auth add cluster 78df35690 srv1 http://172.0.10.50

# check the list of the clusters
$ ais auth show cluster
CLUSTER ID      ALIAS   URLs
2xs35th89               http://172.0.10.10,http://10.0.10.10
78df35690       srv1    http://172.0.10.50

# check the list of generated roles. Note that for convenience,
# the role description includes both ID and alias if appropriate
$ ais auth show role
ROLE                    DESCRIPTION
Admin                   AuthN administrator
BucketOwner-2xs35th89   Full access to buckets of cluster 2xs35th89
BucketOwner-srv1        Full access to buckets of cluster 78df35690[srv1]
ClusterOwner-2xs35th89  Full access to cluster 2xs35th89
ClusterOwner-srv1       Full access to cluster 78df35690[srv1]
Guest-2xs35th89         Read-only access to buckets of cluster 2xs35th89
Guest-srv1              Read-only access to buckets of cluster 78df35690[srv1]
```
