<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>REBALANCE | AIStore - distributed object storage</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="REBALANCE" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore" />
<meta property="og:description" content="AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore" />
<link rel="canonical" href="http://localhost:4000/aistore/docs/rebalance" />
<meta property="og:url" content="http://localhost:4000/aistore/docs/rebalance" />
<meta property="og:site_name" content="AIStore - distributed object storage" />
<script type="application/ld+json">
{"headline":"REBALANCE","@type":"WebPage","url":"http://localhost:4000/aistore/docs/rebalance","description":"AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/aistore/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/aistore/feed.xml" title="AIStore - distributed object storage" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/aistore/">AIStore - distributed object storage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">REBALANCE</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="" itemprop="datePublished">
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="table-of-contents">Table of Contents</h2>

<ul>
  <li><a href="#global-rebalancing">Global Rebalancing</a></li>
  <li><a href="#local-rebalancing">Local Rebalancing</a></li>
</ul>

<h2 id="global-rebalancing">Global Rebalancing</h2>

<p>To maintain <a href="https://en.wikipedia.org/wiki/Consistent_hashing#Examples_of_use">consistent distribution of user data at all times</a>, AIStore rebalances itself based on <em>new</em> versions of its <a href="/cluster/map.go">cluster map</a>.</p>

<p>More exactly:</p>

<ul>
  <li>When storage targets join or leave the cluster, the current <em>primary</em> (leader) proxy transactionally creates the <em>next</em> updated version of the cluster map;</li>
  <li><a href="/ais/metasync.go">Synchronizes</a> the new map across the entire cluster so that each and every node gets the version;</li>
  <li>Which further results in each AIS target starting to traverse its locally stored content, recomputing object locations,</li>
  <li>And sending at least some of the objects to their respective <em>new</em> locations</li>
  <li>Whereby object migration is carried out via intra-cluster optimized <a href="/transport/README.md">communication mechanism</a> and over a separate <a href="/cmn/network.go">physical or logical network</a>, if provisioned.</li>
</ul>

<p>Thus, cluster-wide rebalancing is totally and completely decentralized. When a single server joins (or goes down in a) cluster of N servers, approximately 1/Nth of the entire namespace will get rebalanced via direct target-to-target transfers.</p>

<p>Further, cluster-wide rebalancing does not require any downtime. Incoming GET requests for the objects that haven’t yet migrated (or are being moved) are handled internally via the mechanism that we call “get-from-neighbor”. The (rebalancing) target that must (according to the new cluster map) have the object but doesn’t will locate its “neighbor”, get the object, and satisfy the original GET request transparently from the user.</p>

<h2 id="local-rebalancing">Local Rebalancing</h2>

<p>While global rebalancing (previous section) takes care of the <em>cluster-grow</em> and <em>cluster-shrink</em> events, local rebalancing, as the name implies, is responsible for the <em>mountpath-added</em> and <em>mountpath-removed</em> events that are handled locally within (and by) each storage target.</p>

<ul>
  <li>A <a href="./overview.md#terminology">mountpath</a> is a single disk <strong>or</strong> a volume (a RAID) formatted with a local filesystem of choice, <strong>and</strong> a local directory that AIS utilizes to store user data and AIS metadata. A mountpath can be disabled and (re)enabled, automatically or administratively, at any point during runtime. In a given cluster, a total number of mountpaths would normally compute as a direct product of (number of storage targets) x (number of disks in each target).</li>
</ul>

<p>As stated, mountpath removal can be done administratively (via API) or be triggered by a disk fault (see <a href="/health/fshc.md">filesystem health checking</a>. Irrespectively of the original cause, mountpath-level events activate local rebalancer that in many ways performs the same set of steps as the global one. The one salient difference is that all object migrations are local (and, therefore, relatively fast(er)).</p>

<h2 id="io-performance">IO Performance</h2>

<p>During rebalancing, response latency and overall cluster throughput may substantially degrade.</p>

  </div><a class="u-url" href="/aistore/docs/rebalance" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/aistore/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">AIStore - distributed object storage</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">AIStore - distributed object storage</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
