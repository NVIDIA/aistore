<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>DOCKER_MAIN | AIStore - distributed object storage</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="DOCKER_MAIN" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore" />
<meta property="og:description" content="AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore" />
<link rel="canonical" href="http://localhost:4000/aistore/docs/docker_main" />
<meta property="og:url" content="http://localhost:4000/aistore/docs/docker_main" />
<meta property="og:site_name" content="AIStore - distributed object storage" />
<script type="application/ld+json">
{"headline":"DOCKER_MAIN","@type":"WebPage","url":"http://localhost:4000/aistore/docs/docker_main","description":"AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/aistore/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/aistore/feed.xml" title="AIStore - distributed object storage" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/aistore/">AIStore - distributed object storage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">DOCKER_MAIN</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="" itemprop="datePublished">
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="introduction">Introduction</h2>

<p>AIStore can be run as a cluster of Docker containers. There are two modes of operation: development and quick-start. They can be found in the <a href="/deploy/dev/docker"><code class="highlighter-rouge">deploy/dev/docker</code></a> directory.</p>

<h3 id="development-mode">Development Mode</h3>
<p>This mode is currently used for development purposes.
All docker containers mount the same host’s AIStore source directory, and then execute from this single source. Upon restart (of the AIStore cluster), all changes made in the host will, therefore, take an immediate effect.</p>

<blockquote>
  <p>The development mode is currently being maintained and updated.</p>
</blockquote>

<h3 id="quick-start-mode">Quick Start Mode</h3>
<p>Use this mode if you would like to set up a containerized, one-proxy, one-target deployment of AIStore within seconds. <a href="/deploy/dev/docker/README.md#quick-start-ais-cluster">See quick start AIS with Docker</a>. You just need Docker installed to quick-start AIS.</p>

<p>For an introduction to Docker, please watch <a href="https://www.youtube.com/watch?v=V9IJj4MzZBc">Docker 101 youtube</a></p>

<h2 id="install-docker-and-docker-compose">Install Docker and Docker Compose</h2>
<p><strong>Note:</strong> Using Docker requires one of the following versions of Ubuntu:</p>
<ul>
  <li>Bionic 18.04 (LTS)</li>
  <li>Xenial 16.04 (LTS)</li>
  <li>Trusty 14.04 (LTS)</li>
</ul>

<ol>
  <li>Uninstall any old versions of docker:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo </span>apt-get remove docker docker-engine docker.io
</code></pre></div>    </div>
    <p>It’s OK if apt-get reports that none of these packages are installed.</p>
  </li>
  <li>Update the apt package index:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo </span>apt-get update
</code></pre></div>    </div>
  </li>
  <li>Install packages to allow apt to use a repository over HTTPS:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="se">\</span>
     apt-transport-https <span class="se">\</span>
     ca-certificates <span class="se">\</span>
     curl <span class="se">\</span>
     software-properties-common
</code></pre></div>    </div>
  </li>
  <li>Install Docker
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>docker-ce
</code></pre></div>    </div>
    <p><strong>Note:</strong> For version <code class="highlighter-rouge">16.04</code> and up, <code class="highlighter-rouge">docker-ce</code> is not in the default Ubuntu repository. See <a href="https://docs.docker.com/v17.09/engine/installation/linux/docker-ce/ubuntu/#install-docker-ce-1">this guide</a> for <code class="highlighter-rouge">docker-ce</code> installation.</p>
  </li>
  <li>Verify that Docker CE is installed correctly by running the “hello-world” image.
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo </span>docker run hello-world
</code></pre></div>    </div>
  </li>
  <li>Add your current user to the Docker group (but only if you are not the root). After executing the command, restart your machine for it to take effect.
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker <span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span>
</code></pre></div>    </div>
  </li>
  <li>Install Docker-Compose using python <code class="highlighter-rouge">pip</code>. Install <code class="highlighter-rouge">pip</code> if you don’t have it:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> python-pip
 <span class="nv">$ </span><span class="nb">sudo </span>pip <span class="nb">install </span>docker-compose
</code></pre></div>    </div>
  </li>
  <li>Test the installation:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>docker-compose <span class="nt">--version</span>
 docker-compose version 1.23.1, build 1719ceb
</code></pre></div>    </div>
  </li>
  <li>If you have any troubles with your installation, consider using the latest version of <a href="https://docs.docker.com/install/">Docker</a> and <a href="https://github.com/docker/compose/releases">Docker-Compose</a>.</li>
</ol>

<h2 id="uninstall-docker-and-docker-compose">Uninstall Docker and Docker Compose</h2>
<ol>
  <li>To uninstall Docker, run the following:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo </span>apt-get purge docker-ce
 <span class="nv">$ </span><span class="nb">sudo </span>apt-get purge docker-ce-cli
</code></pre></div>    </div>
  </li>
  <li>Ensure docker is completely uninstalled by running the following command:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>dpkg <span class="nt">-l</span> | <span class="nb">grep</span> <span class="nt">-i</span> docker
</code></pre></div>    </div>
    <p>There should be no docker-ce and docker-ce-cli packages listed.</p>
  </li>
  <li>To uninstall Docker-Compose, run the following:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pip uninstall docker-compose
</code></pre></div>    </div>
  </li>
  <li>Images, containers, volumes, or customized configuration files on your host are not automatically removed. To delete all images, containers, and volumes:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo rm</span> <span class="nt">-rf</span> /var/lib/docker
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="starting-aistore">Starting AIStore</h2>
<ol>
  <li>If you have already installed go and configured $GOPATH execute the below command to download AIStore source code and all its dependencies.
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>go get <span class="nt">-u</span> <span class="nt">-v</span> github.com/NVIDIA/aistore/ais
</code></pre></div>    </div>
  </li>
  <li>Set up your AWS configuration by using the the <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html"><code class="highlighter-rouge">aws configure</code></a> command.
To run AIStore Docker containers, you will need to pass your AWS config and credential directory via flag <code class="highlighter-rouge">-a=&lt;aws directory&gt;</code> CLI. By default, AWS stores config and credential files in <code class="highlighter-rouge">~/.aws/</code>
Example:
    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./deploy_docker.sh <span class="nt">-a</span><span class="o">=</span>~/.aws/
</code></pre></div>    </div>
  </li>
  <li>To deploy AIStore, refer to the deployment script in <a href="/deploy/dev/docker/README.md"><code class="highlighter-rouge">deploy/dev/docker</code></a>.
Please note that if you are running the service for the first time, the image build process will take some time; subsequent runs will use the cached images and be much faster.</li>
</ol>

<h2 id="helpful-docker-commands">Helpful docker commands</h2>

<h3 id="list-running-containers">List Running Containers</h3>
<p>List all of the running containers using <code class="highlighter-rouge">docker ps</code>. Many commands require the CONTAINER ID or NAME fields. Example output:</p>

<p><img src="/docs/images/docker_ps.png" alt="docker ps" /></p>

<h3 id="list-all-containers">List All Containers</h3>

<p>Lists all containers (not only the running ones).</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker ps <span class="nt">-a</span>
</code></pre></div></div>

<h3 id="view-container-logs">View Container Logs</h3>

<p>To view docker logs, use <code class="highlighter-rouge">docker logs &lt;container_name&gt;</code>. Example:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $ docker logs ais0_proxy_1

    I 21:23:56.400794 metasync.go:142] Starting metasyncer
    I 21:24:06.415473 stats.go:422] {"err.n":0,"get.n":0,"del.n":0,"get.µs":0,"kalive.µs":0,"err.get.n":0,"err.list.n":0,"pst.n":0,"ren.n":0,
    "lst.µs":0,"uptime.µs":0,"kalive.µs.max":0,"err.delete.n":0,"err.post.n":0,"err.range.n":0,"err.head.n":0,"put.n":0,"lst.n":0,
    "kalive.µs.min":0,"err.put.n":0}
    I 21:24:08.386182 proxy.go:2236] joined target 1463af8ddcd3 (num targets 1)
    I 21:24:11.759453 proxy.go:2236] joined target 3c86e5e71978 (num targets 2)
    I 21:24:12.411714 earlystart.go:262] Reached the expected 2/2 target registrations
    I 21:24:12.412098 earlystart.go:228] 0e76b56086eb: merged local Smap (2/1)
    I 21:24:12.412244 metasync.go:290] dosync: smaptag, action=early-start-have-registrations, version=2
    I 21:24:12.412772 metasync.go:290] dosync: bucketmdtag, action=early-start-have-registrations, version=1
    I 21:24:13.425617 earlystart.go:307] 0e76b56086eb: merging discovered Smap v2 (2, 1)

</code></pre></div></div>
<p>Note:</p>
<ul>
  <li>You can obtain the container name by running command <code class="highlighter-rouge">docker ps</code></li>
  <li>The <code class="highlighter-rouge">deploy/dev/docker/</code> directory has a more comprehensive script named <code class="highlighter-rouge">logs.sh</code> to view logs</li>
</ul>

<h3 id="ssh-into-a-container">SSH Into a Container</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $docker exec -it CONTAINER_NAME /bin/bash
</code></pre></div></div>
<p>Note:</p>
<ul>
  <li>In production mode, the logs are expected to be in <code class="highlighter-rouge">/var/log/ais/</code>.By default (development mode) the logs are under <code class="highlighter-rouge">tmp/ais/log</code></li>
  <li>The <code class="highlighter-rouge">deploy/dev/docker/</code> directory has a script named <code class="highlighter-rouge">container_shell.sh</code> that does the same thing</li>
</ul>

<h3 id="list-docker-images">List Docker Images</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $ docker image ls

    REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
    ais1_proxy          latest              ced2cbd2ff2f        27 minutes ago      676MB
    ais1_target         latest              ced2cbd2ff2f        27 minutes ago      676MB
    ais0_proxy          latest              4c3fbcb54e4d        27 minutes ago      676MB
    ais0_target         latest              4c3fbcb54e4d        27 minutes ago      676MB
</code></pre></div></div>

<h3 id="list-docker-networks">List Docker Networks</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $ docker network ls

    NETWORK ID          NAME                    DRIVER              SCOPE
    cb05b22edcb3        bridge                  bridge              local
    86517bef938d        ais0_internal_control   bridge              local
    51f49b56fe57        ais0_internal_data      bridge              local
    2cee0651aa72        ais0_public             bridge              local
    e11635deb15d        ais1_internal_control   bridge              local
    9eefba13018f        ais1_internal_data      bridge              local
    674fee80acac        ais1_public             bridge              local
</code></pre></div></div>

<h3 id="start-a-container">Start a Container</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker start CONTAINER_NAME
</code></pre></div></div>

<h3 id="stop-a-container">Stop a Container</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker stop CONTAINER_NAME
</code></pre></div></div>

<h3 id="restart-a-container">Restart a Container</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker restart CONTAINER_NAME
</code></pre></div></div>

<h3 id="kill-a-container">Kill a Container</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker <span class="nb">kill </span>CONTAINER_NAME
</code></pre></div></div>

<h3 id="view-resource-usage-statistics-for-all-containers">View Resource Usage Statistics for all Containers</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker stats
</code></pre></div></div>

<h3 id="remove-unused-images">Remove Unused Images</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker image prune <span class="nt">-f</span>
</code></pre></div></div>

<h3 id="remove-all-stopped-containers">Remove all Stopped Containers</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker container prune <span class="nt">-f</span>
</code></pre></div></div>

<h3 id="remove-all-unused-networks">Remove all Unused Networks</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker network prune <span class="nt">-f</span>
</code></pre></div></div>

<h3 id="stop-all-running-containers">Stop all Running Containers</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker stop <span class="si">$(</span>docker ps <span class="nt">-a</span> <span class="nt">-q</span><span class="si">)</span>
</code></pre></div></div>

<h3 id="delete-all-existing-containers">Delete all Existing Containers</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker <span class="nb">rm</span> <span class="si">$(</span>docker ps <span class="nt">-a</span> <span class="nt">-q</span><span class="si">)</span>
</code></pre></div></div>

<h3 id="delete-all-existing-images">Delete all Existing Images</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$ </span>docker rmi <span class="si">$(</span>docker images <span class="nt">-q</span> <span class="nt">-a</span><span class="si">)</span>
</code></pre></div></div>

<h2 id="docker-playground">Docker playground</h2>

<p>Following is a super-simple presentation to showcase some of the AIS capabilities.</p>

<p>In <a href="../deploy/dev/docker/playground">Docker playground</a>, you can find the scripts to download different popular AI datasets (e.g., MNIST and ImageNet). The datasets are downloaded with the AIS-integrated <a href="../downloader/README.md">Downloader</a> that stores all downloaded objects directly into the AIStore.</p>

<p>During the download, you can monitor:</p>

<ul>
  <li>number of requests made</li>
  <li>number of requests failed</li>
  <li>number of bytes transferred</li>
</ul>

<p>In the example below, AIS downloads a handful of ImageNet images and collects/visualizes the corresponding statistics:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>path_to/deploy/dev/docker
<span class="nv">$ </span>./deploy_docker.sh <span class="nt">-d</span><span class="o">=</span>2 <span class="nt">-p</span><span class="o">=</span>2 <span class="nt">-t</span><span class="o">=</span>4 <span class="nt">-c</span><span class="o">=</span>1 <span class="nt">-grafana</span> <span class="nt">-nocloud</span> <span class="c"># start 2 proxies and 4 targets</span>
<span class="nv">$ </span>./playground/download_imagenet.sh <span class="c"># download some of ImageNet images into AIS and show stats</span>
<span class="nv">$ </span><span class="c"># once Downloader will save the files...</span>
<span class="nv">$ </span>./playground/stress_get.sh imagenet <span class="c"># do gets on saved files (requires jq command)</span>
<span class="nv">$ </span>./stop_docker.sh <span class="nt">-l</span> <span class="c"># stop docker</span>
</code></pre></div></div>

<p><img src="images/playground-grafana.png" alt="Playground Grafana dashboard" width="400" /></p>

  </div><a class="u-url" href="/aistore/docs/docker_main" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/aistore/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">AIStore - distributed object storage</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">AIStore - distributed object storage</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
