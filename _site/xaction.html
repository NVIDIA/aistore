<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>XACTION | AIStore - distributed object storage</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="XACTION" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore" />
<meta property="og:description" content="AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore" />
<link rel="canonical" href="http://localhost:4000/aistore/xaction" />
<meta property="og:url" content="http://localhost:4000/aistore/xaction" />
<meta property="og:site_name" content="AIStore - distributed object storage" />
<script type="application/ld+json">
{"headline":"XACTION","@type":"WebPage","url":"http://localhost:4000/aistore/xaction","description":"AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/aistore/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/aistore/feed.xml" title="AIStore - distributed object storage" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/aistore/">AIStore - distributed object storage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">XACTION</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="" itemprop="datePublished">
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="table-of-contents">Table of Contents</h2>
<ul>
  <li><a href="#extended-actions-xactions">Extended Actions (xactions)</a>
    <ul>
      <li><a href="#start-stop">Start &amp; Stop</a></li>
      <li><a href="#stats">Stats</a></li>
    </ul>
  </li>
</ul>

<h2 id="extended-actions-xactions">Extended Actions (xactions)</h2>

<p>Extended actions (xactions) are batch operations that may take seconds, sometimes minutes or even hours, to execute. Xactions run asynchronously, have one of the enumerated kinds, start/stop times, and xaction-specific statistics. Xactions start running based on a wide variety of runtime conditions that include:</p>

<ul>
  <li>periodic (defined by a configured interval of time)</li>
  <li>resource utilization (e.g., usable capacity falling below configured watermark)</li>
  <li>certain type of workload (e.g., PUT into a mirrored or erasure-coded bucket)</li>
  <li>user request (e.g., to reduce the number of local object copies in a given bucket)</li>
  <li>adding or removing storage targets (the events that trigger cluster-wide rebalancing)</li>
  <li>adding or removing local disks (the events that cause local rebalancer to start moving stored content between <em>mountpaths</em> - see <a href="/docs/configuration.md#managing-filesystems">Managing filesystems</a>)</li>
  <li>and more.</li>
</ul>

<p>Further, to reduce congestion and minimize interference with user-generated workload, extended actions (self-)throttle themselves based on configurable watermarks. The latter include <code class="highlighter-rouge">disk_util_low_wm</code> and <code class="highlighter-rouge">disk_util_high_wm</code> (see <a href="/ais/setup/config.sh">configuration</a>). Roughly speaking, the idea is that when local disk utilization falls below the low watermark (<code class="highlighter-rouge">disk_util_low_wm</code>) extended actions that utilize local storage can run at full throttle. And vice versa.</p>

<p>The amount of throttling that a given xaction imposes on itself is always defined by a combination of dynamic factors. To give concrete examples, an extended action that runs LRU evictions performs its “balancing act” by taking into account the remaining storage capacity <em>and</em> the current utilization of the local filesystems. The two-way mirroring (xaction) takes into account congestion on its communication channel that callers use for posting requests to create local replicas. And the <code class="highlighter-rouge">atimer</code> - extended action responsible for <a href="/atime/atime.go">access time updates</a> - self-throttles based on the remaining space (to buffer atimes), etc.</p>

<p>Supported extended actions are enumerated in the <a href="/cmn/api.go">user-facing API</a> and include:</p>

<ul>
  <li>Cluster-wide rebalancing (denoted as <code class="highlighter-rouge">ActGlobalReb</code> in the <a href="/cmn/api.go">API</a>) that gets triggered when storage targets join or leave the cluster;</li>
  <li>LRU-based cache eviction (see <a href="/docs/storage_svcs.md#lru">LRU</a>) that depends on the remaining free capacity and <a href="/ais/setup/config.sh">configuration</a>;</li>
  <li>Prefetching batches of objects (or arbitrary size) from the Cloud (see <a href="/docs/batch.md">List/Range Operations</a>);</li>
  <li>Consensus voting (when conducting new leader <a href="/docs/ha.md#election">election</a>);</li>
  <li>Erasure-encoding objects in a EC-configured bucket (see <a href="/docs/storage_svcs.md#erasure-coding">Erasure coding</a>);</li>
  <li>Creating additional local replicas, and</li>
  <li>Reducing number of object replicas in a given locally-mirrored bucket (see <a href="/docs/storage_svcs.md">Storage Services</a>);</li>
  <li>and more.</li>
</ul>

<p>There are different actions that may be taken upon xaction. Actions include stats, start and stop.
List of supported actions can be found in the <a href="/cmn/api.go">API</a></p>

<p>Xaction requests are generic for all xactions, but responses from each xaction are different. See <a href="#start-&amp;-stop">below</a>.
The request looks as follows:
1.Single target request:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-i</span> <span class="nt">-X</span> GET  <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="nt">-d</span> <span class="s1">'{"action": "actiontype", "name": "xactionname", "value":{"bucket":"bucketname"}}'</span> <span class="s1">'http://T/v1/daemon?what=xaction'</span>
</code></pre></div></div>
<p>To simplify the logic, result is always an array, even if there’s only one element in the result</p>

<p>2.Proxy request, which executes a request on all targets within the cluster, and responds with list of targets’ responses:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-i</span> <span class="nt">-X</span> GET  <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="nt">-d</span> <span class="s1">'{"action": "actiontype", "name": "xactionname", "value":{"bucket":"bucketname"}}'</span> <span class="s1">'http://G/v1/cluster?what=xaction'</span>
</code></pre></div></div>
<p>Response of a query to proxy is a map of daemonID -&gt; target’s response. If any of targets responded with error status code, the proxy’s response
will result in the same error response.</p>

<h3 id="start--stop">Start &amp; Stop</h3>
<p>For a successful request, the response only contains the HTTP status code. If the request was sent to the proxy and all targets
responded with a successful HTTP code, the proxy would respond with the successful HTTP code. The response body should be omitted.</p>

<p>For an unsuccessful request, the target’s response contains the error code and error message. If the request was sent to proxy and at least one
of targets responded with an error code, the proxy will respond with the same error code and error message.</p>

<blockquote>
  <blockquote>
    <p>As always, <code class="highlighter-rouge">G</code> above (and throughout this entire README) serves as a placeholder for the <em>real</em> gateway’s hostname/IP address and <code class="highlighter-rouge">T</code> serves for placeholder for target’s hostname/IP address. More information in <a href="/docs/http_api.md#notation">notation section</a>.</p>
  </blockquote>
</blockquote>

<p>The corresponding <a href="/docs/http_api.md">RESTful API</a> includes support for querying all xactions including global-rebalancing and prefetch operations.</p>

<h3 id="stats">Stats</h3>

<p>Stats request results in list of requested xactions. Statistics of each xaction share a common base format which looks as follow:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
   </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"kind"</span><span class="p">:</span><span class="s2">"ecget"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"bucket"</span><span class="p">:</span><span class="s2">"test"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"startTime"</span><span class="p">:</span><span class="s2">"2019-04-15T12:40:18.721697505-07:00"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"endTime"</span><span class="p">:</span><span class="s2">"0001-01-01T00:00:00Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"InProgress"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="nl">"kind"</span><span class="p">:</span><span class="s2">"ecput"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"bucket"</span><span class="p">:</span><span class="s2">"test"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"startTime"</span><span class="p">:</span><span class="s2">"2019-04-15T12:40:18.721723865-07:00"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"endTime"</span><span class="p">:</span><span class="s2">"0001-01-01T00:00:00Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"InProgress"</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>
<p>Any xaction can have additional fields, which are included in additional field called <code class="highlighter-rouge">"ext"</code></p>

<p>Example rebalance stats response:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
      </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rebalance"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"bucket"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
      </span><span class="nl">"start_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-04-15T13:38:51.556388821-07:00"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"end_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0001-01-01T00:00:00Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"InProgress"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"ext"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"tx.n"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"tx.size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"rx.n"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"rx.size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>If flag <code class="highlighter-rouge">--all</code> is provided, stats command will display old, finished xactions, along with currently running ones. If <code class="highlighter-rouge">--all</code> is not set (default), only
the most recent xactions will be displayed, for each bucket, kind or (bucket, kind)</p>

  </div><a class="u-url" href="/aistore/xaction" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/aistore/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">AIStore - distributed object storage</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">AIStore - distributed object storage</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
