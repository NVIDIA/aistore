<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>DEPLOY/PROD/DOCKER/GTC2020 | AIStore - distributed object storage</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="DEPLOY/PROD/DOCKER/GTC2020" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore" />
<meta property="og:description" content="AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore" />
<link rel="canonical" href="http://localhost:4000/aistore/deploy/prod/docker/gtc2020" />
<meta property="og:url" content="http://localhost:4000/aistore/deploy/prod/docker/gtc2020" />
<meta property="og:site_name" content="AIStore - distributed object storage" />
<script type="application/ld+json">
{"headline":"DEPLOY/PROD/DOCKER/GTC2020","@type":"WebPage","url":"http://localhost:4000/aistore/deploy/prod/docker/gtc2020","description":"AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/aistore/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/aistore/feed.xml" title="AIStore - distributed object storage" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/aistore/">AIStore - distributed object storage</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">DEPLOY/PROD/DOCKER/GTC2020</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="" itemprop="datePublished">
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="gtc2020-infrastructure-for-ais-and-webdataset-demo">GTC2020 Infrastructure for AIS and WebDataset Demo</h1>

<h2 id="overview">Overview</h2>

<h2 id="build-and-upload">Build and upload</h2>

<h3 id="ais-binaries">AIS Binaries</h3>

<p>If/when we need to rebuild the <code class="highlighter-rouge">aisnode</code> or <code class="highlighter-rouge">ais</code> binaries</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./build_ais_binaries_containers.sh
</code></pre></div></div>
<p>will build (but not push to a repo) containers <code class="highlighter-rouge">ais-binaries:alpine</code> and <code class="highlighter-rouge">ais-binaries:ubuntu</code>, packaging the <code class="highlighter-rouge">aisnode</code> and <code class="highlighter-rouge">ais</code> binaries along with a CLI <code class="highlighter-rouge">config.json</code> for the DL client container.</p>

<p>To push these to Docker Hub:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./publish_ais_binaries.sh &lt;tag&gt;
</code></pre></div></div>
<p>will tag the local images as <code class="highlighter-rouge">gmaltby/ais-binaries:alpine-&lt;tag&gt;</code> and <code class="highlighter-rouge">gmaltby/ais-binaries:ubuntu-&lt;tag&gt;</code> and then push them to Docker Hub (as long as you have my ssh key etc). We push them to Docker Hub so that DLI can utilize these binaries in building containers without having to clone and build the ais repo.</p>

<h3 id="ais-container">AIS Container</h3>

<p>To build the AIS container for GTC:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./build_ais_container.sh &lt;<span class="s1">'local'</span>|tag&gt;
</code></pre></div></div>

<p>If the first argument is <code class="highlighter-rouge">local</code> then binaries from the local Docker image repo <code class="highlighter-rouge">ais-binaries:alpine</code> are used; otherwise binaries from <code class="highlighter-rouge">gmaltby/ais-binaries:alpine-&lt;tag&gt;</code> are used. A container image is built (but not further tagged or pushed) for <code class="highlighter-rouge">aisnode-gtc:latest</code> (local tag <code class="highlighter-rouge">latest</code> is always applied).</p>

<p>To push the container to Docker Hub:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./publish_ais_container.sh &lt;tag&gt;
</code></pre></div></div>
<p>This will further tag <code class="highlighter-rouge">aisnode-gtc:latest</code> as <code class="highlighter-rouge">gmaltby/aisnode-gtc:&lt;tag&gt;</code> and push it to Docker Hub. Avoid pushing tags such as <code class="highlighter-rouge">latest</code> to Docker Hub - rather use a dated tag, or a hash.</p>

<h2 id="run">Run</h2>

<p>GTC will massage the following for Docker Compose; we describe how to run manually.</p>

<h3 id="create-a-user-network">Create a User Network</h3>

<p>To be able to resolve container names in DNS we employ a user network - the default bridge does not support DNS.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker network create gtc
</code></pre></div></div>

<h3 id="run-the-ais-container">Run the AIS Container</h3>

<p>This must be named <code class="highlighter-rouge">ais</code> (DL notebooks depend on the name) and be attached to the network created above.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--name</span> ais <span class="nt">--network</span> gtc <span class="nt">-it</span> <span class="nt">--rm</span> gmaltby/aisnode-gtc:&lt;tag&gt;
</code></pre></div></div>
<p>choosing the published image, or point to a local one if desired. The container automatically runs a single proxy, single target AIS instance using the container root filesystem for data (so it’s lost when the container exits!).</p>

<p>Since only the DL container is going to talk to AIS, there is no need to publish ports (all containers on a user network are open to one-another on all active ports).</p>

<h3 id="run-the-dl-container-built-externally">Run the DL Container (built externally)</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--name</span> dl <span class="nt">--network</span> gtc <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">-p</span> 8888:8888 gmaltby/dltorch-gtc:&lt;tag&gt;
</code></pre></div></div>

<p>Connect to http://localhost:8888 to access the Jupyter notebook; the password is ‘root’.</p>

  </div><a class="u-url" href="/aistore/deploy/prod/docker/gtc2020" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/aistore/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">AIStore - distributed object storage</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">AIStore - distributed object storage</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>AIStore is a lightweight object storage system with the capability to linearly scale-out with each added storage node and a special focus on petascale deep learning. See more at: github.com/NVIDIA/aistore
</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
